<html>
<head>
</head>
<body>
<script src="static/libflac_data-util.js"></script>
<script src="static/libflac4-1.3.2.js"></script>
<script src="static/decode-func.js"></script>
<script>

function toWav(metadata, decData) {
    var samples = interleave(decData, metadata.channels, metadata.bitsPerSample);
	var dataView = encodeWAV(samples, metadata.sampleRate, metadata.channels, metadata.bitsPerSample);
    return dataView.buffer;
}


function DecodeFlac( thedata) {
    var decData = [];
	var result = decodeFlac(new Uint8Array(thedata), decData, false);
    console.log('decoded data array: ', decData);
	
	if(result.error){
		console.log(result.error);
	}

	var metaData = result.metaData;
	if(metaData){		
		for(var n in metaData){
			console.log( n + ' ' + 	metaData[n]);
		}		
	}
    toWav(metaData, decData);    
}



function loadFile(file) {
  var xhttp = new XMLHttpRequest();
  xhttp.responseType = "arraybuffer";
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      DecodeFlac(this.response);
    }
  };
  xhttp.open("GET", file, true);
  xhttp.send();
}

var MainAudioContext = new (window.AudioContext || window.webkitAudioContext)();

loadFile("music_dl?name=Fever%20Ray%20-%202009%20-%20Fever%20Ray%20(Deluxe%20Edition)%20(FLAC)%2F06%20-%20Concrete%20Walls.flac&max_sample_rate=48000&gapless=1&gdriveforce=1&part=69");



</script>
</body>
</html>


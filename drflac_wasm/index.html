<script src="drflac.js"></script>
<!-- <script src="drflac.wasm"></script> -->
<script>
    const get_audio = Module.cwrap('get_audio', "number", ["string", "number", "number"], {async : true});
    Module.onRuntimeInitialized = function() {
        (async() => {

            let result = await get_audio("../music_dl?action=dl&name=Jonathan%20Davis%20-%20Black%20Labyrinth%20%282018%29%2F06%20-%20Walk%20On%20By.flac", 0, 5);
            if(result != 0)
            {           
                // header     
                let uint64s = new BigUint64Array(Module.HEAPU8.buffer, result, 2);
                let framesDecoded = Number(uint64s[0]);
                let totalFrames   = Number(uint64s[1]);
                let uint32s = new Uint32Array(Module.HEAPU8.buffer, result+16, 1);
                let sampleRate =  uint32s[0];
                let uint8s  = new Uint8Array(Module.HEAPU8.buffer, result+20, 2);
                let bps = uint8s[0];
                let channels = uint8s[1];
                console.log('framesDecoded ' + framesDecoded);
                console.log('totalFrames ' + totalFrames);
                console.log('sampleRate ' + sampleRate);
                console.log('bits per sample ' + bps);
                console.log('num channels ' + channels);

                // audio data
                let chanzero = new Float32Array(Module.HEAPU8.buffer, result+32, framesDecoded);
                let chanone  = new Float32Array(Module.HEAPU8.buffer, (result+32)+(4*framesDecoded), framesDecoded)
                console.log('aaaa');
                // leaks mem
            }
            
           /* get_audio("../music_dl?action=dl&name=Jonathan%20Davis%20-%20Black%20Labyrinth%20%282018%29%2F06%20-%20Walk%20On%20By.flac", 30, 5);*/
            
        })();
        
    };    
</script>